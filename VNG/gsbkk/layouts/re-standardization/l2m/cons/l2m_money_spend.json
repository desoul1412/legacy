{
  "description": "L2M Money Spend CONS: Read from ETL, enrich with user profile (country + VIP), write to PostgreSQL",
  "comment": "Consolidates money spend data enriched with user country and VIP level segmentation",
  "inputSources": [
    {
      "name": "money_data",
      "type": "file",
      "path": "hdfs://c0s/user/gsbkk-workspace-yc9t6/l2m/etl/money_spend/{logDate}",
      "format": "parquet"
    },
    {
      "name": "user_profile",
      "type": "jdbc",
      "connection": "GDS_POSTGRES",
      "query": "SELECT user_id, CASE WHEN country_code IN ('TH','VN','ID','PH','SG','MY') THEN country_code ELSE 'Others' END AS country_code FROM public.mkt_user_profile"
    }
  ],
  "sqlTemplate": "templates/re-standardization/l2m/money_spend_cons.sql.j2",
  "outputs": [
    {
      "type": "jdbc",
      "connection": "TSN_POSTGRES",
      "table": "public.l2m_money_spend",
      "format": "parquet",
      "mode": "append",
      "deleteCondition": "report_date = DATE '{logDate}'"
    }
  ]
}
